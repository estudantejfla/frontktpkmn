<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Meus Times</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <video autoplay muted loop id="bg-video" class="background-video">
    <source src="imagens/background.mp4" type="video/mp4">
  </video>

  <div class="container">
    <div class="navbar">
      <a href="index.html">Login</a>
      <a href="times.html">Meus Times</a>
      <a href="criar_time.html">Criar Time</a>
      <a href="publicos.html">Times Públicos</a>
    </div>

    <h1>Bem-vindo, <span id="usuario"></span>!</h1>
    <h2>Meus Times</h2>

    <div id="meusTimes"></div>
    <button onclick="window.location.href='criar_time.html'">Criar Novo Time</button><br><br>

    <a href="#" onclick="logout()">Sair</a>
  </div>

  <script>
    const API = "https://backpkmn.onrender.com";
    const token = localStorage.getItem("token");
    const username = localStorage.getItem("username");

    if (!token) {
      alert("Você precisa estar logado");
      window.location.href = "index.html";
    }

    document.getElementById("usuario").textContent = username;

    let pokemonList = [];

    async function loadPokemonList() {
      for (let i = 1; i <= 151; i++) {
        let res = await fetch(`https://pokeapi.co/api/v2/pokemon/${i}`);
        let poke = await res.json();
        pokemonList.push(poke);
      }
      loadTeams();
    }

    function getSprite(name) {
      let p = pokemonList.find(p => p.name === name.toLowerCase());
      return p ? p.sprites.front_default : "";
    }

    async function loadTeams() {
      let res = await fetch(`${API}/api/teams`, {
        headers: { Authorization: `Bearer ${token}` }
      });

      if (!res.ok) {
        alert("Erro ao carregar times");
        return;
      }

      const teams = await res.json();
      const div = document.getElementById("meusTimes");

      if (teams.length === 0) {
        div.innerHTML = "<p>Você ainda não criou nenhum time.</p>";
        return;
      }

      div.innerHTML = "";

      teams.forEach(t => {
        const pokemons = JSON.parse(t.pokemons); // vem salvo como JSON no backend

        const card = document.createElement("div");
        card.className = "card";

        let pokeHTML = pokemons.map(p => `
          <div class="pokemon-item">
            <img src="${getSprite(p)}" width="40">
            <span>${p}</span>
          </div>
        `).join("");

        card.innerHTML = `
          <strong>${t.name}</strong><br>
          <div class="pokemon-container">${pokeHTML}</div>
        `;

        div.appendChild(card);
      });
    }

    function logout() {
      localStorage.removeItem("token");
      localStorage.removeItem("username");
      window.location.href = "index.html";
    }

    loadPokemonList();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Times Públicos</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <video autoplay muted loop id="bg-video" class="background-video">
    <source src="imagens/background.mp4" type="video/mp4">
  </video>

  <div class="container">
    <div class="navbar">
      <a href="index.html">Login</a>
      <a href="times.html">Meus Times</a>
      <a href="criar_time.html">Criar Time</a>
      <a href="publicos.html">Times Públicos</a>
    </div>

    <h1>Times Públicos</h1>
    <div id="lista"></div>
    <br>
    <a href="times.html" class="back-button">Voltar</a>
  </div>

  <script>
    const API = "https://backpkmn.onrender.com";
    const token = localStorage.getItem("token");

    if (!token) {
      alert("Você precisa estar logado para ver times públicos");
      window.location.href = "index.html";
    }

    let pokemonList = [];

    // ---------------------------
    // 1. Carregar sprites
    // ---------------------------
    async function loadPokemonList() {
      for (let i = 1; i <= 151; i++) {
        let res = await fetch(`https://pokeapi.co/api/v2/pokemon/${i}`);
        let poke = await res.json();
        pokemonList.push(poke);
      }
      loadPublicTeams();
    }

    function getSprite(name) {
      let p = pokemonList.find(p => p.name === name.toLowerCase());
      return p ? p.sprites.front_default : "";
    }

    // ---------------------------
    // 2. Carregar times públicos do backend real
    // ---------------------------
    async function loadPublicTeams() {
      let res = await fetch(`${API}/api/public`);
      let times = await res.json();

      let div = document.getElementById("lista");

      if (times.length === 0) {
        div.innerHTML = "<p>Nenhum time público ainda.</p>";
        return;
      }

      div.innerHTML = "";

      // Para cada time
      times.forEach(t => {
        const pokemons = JSON.parse(t.pokemons);

        let pokeHTML = pokemons.map(p => `
          <div class="pokemon-item">
            <img src="${getSprite(p)}" width="60">
            <span>${p}</span>
          </div>
        `).join("");

        let card = document.createElement("div");
        card.className = "card time-card";

        card.innerHTML = `
          <h3>${t.name}</h3>
          <p class="time-owner">Por: <strong>${t.owner.username}</strong></p>
          <div class="pokemon-grid">${pokeHTML}</div>
        `;

        div.appendChild(card);
      });
    }

    loadPokemonList();
  </script>

</body>
</html>
